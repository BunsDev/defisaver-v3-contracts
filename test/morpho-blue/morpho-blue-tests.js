const hre = require('hardhat');
const {
    takeSnapshot, revertToSnapshot, getProxy, impersonateAccount,
    stopImpersonatingAccount, sendEther, setBalance, approve,
} = require('../utils');

const deployMorphoBlueMarket = async () => {
    const [wallet] = await hre.ethers.getSigners();
    const firstContractCreationData = '0x604580600e600039806000f350fe7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf3';
    const firstContractCreateTx = await wallet.sendTransaction({ data: firstContractCreationData });
    const firstContract = await firstContractCreateTx.wait();
    const morphoBlueDeployTxData = '0x000000000000000000000000000000000000000000000000000000000000000060a034620001aa576001600160401b0390601f1990601f6200307a3881900391820184168301929185841183851017620001395780839260409586528339602092839181010312620001aa57516001600160a01b0381169390849003620001aa5782518381018181108782111762000139578452600c81526b7a65726f206164647265737360a01b8382015284156200014f5750508151908101917f47e79534a245952e8b16893a336b85a3d9ea9fa8c573f3d803afb92a7946921883524681830152306060830152606082526080820194828610908611176200013957849052519020608052600080546001600160a01b031916821781557f167d3e9c1016ab80e58802ca9da10ce5c6a0f4debc46a2e7a2cd9e56899a4fb59080a2612eca9081620001b082396080518181816112370152611bac0152f35b634e487b7160e01b600052604160045260246000fd5b82845192839162461bcd60e51b835280600484015283519081602485015260005b828110620001925750506044935080600085601f938601015201168101030190fd5b80860182015187820160440152869450810162000170565b600080fdfe6080604052600436101561001257600080fd5b6000803560e01c806313af40351461213a578063151c1ade146120f157806320b76e8114611ed8578063238d657914611d5b5780632b4f013c14611c345780632c3c915714611bcf5780633644e51514611b945780634690484014611b6b5780634d98a93b14611aa657806350d8cd4b146118615780635a64f51e146117d05780635c2bea49146115dd5780635c60e39a1461157357806365e4ad9e1461151f57806370ae92d2146114e65780637784c685146113d05780638069218f146110ad5780638720316d14610f705780638c1358a214610d835780638da5cb5b14610d5c57806393c5206214610cf8578063a99aad8914610b02578063b485f3b814610ad3578063d8eabcb8146103ad578063e0232b42146102b7578063e74b981b14610227578063eecea000146101925763f2b863ce1461015157600080fd5b3461018f57602036600319011261018f5760209060ff906040906001600160a01b0361017b6121c1565b168152600484522054166040519015158152f35b80fd5b503461018f57604036600319011261018f576101ac6121c1565b60243580151590818103610222576101f1903385526006602052604085209360018060a01b0316938460005260205260406000209060ff801983541691151516179055565b60405190815233907fd5e969f01efe921d3f766bdebad25f0a05e3f237311f56482bf132d0326309c060203392a480f35b600080fd5b503461018f57602036600319011261018f576102826102446121c1565b82546001600160a01b03919061026690831633146102606123a2565b906123c7565b81600154911692839261027761242e565b9083168414156123c7565b6001600160a01b031916176001557f2e979f80fe4d43055c584cf4a8467c55875ea36728fc37176c05acd784eb7a738280a280f35b503461018f57606036600319011261018f576102d16121c1565b602435826044356001600160401b0381116103a9576102f49036906004016122da565b6001600160a01b03909416939061030c843387612bd6565b846040518581527fc76f1b4fe4396ac07a9fa55a415d4ca430e72651d37d3401f3bed7cb13fc4f1260203392a3333b1561039a576040516318fab83960e11b81529183918391829161036391908860048501612501565b038183335af1801561039e57610386575b50506103839130903390612ccc565b80f35b61038f90612203565b61039a578238610374565b8280fd5b6040513d84823e3d90fd5b5080fd5b503461018f5761012036600319011261018f576103c93661226d565b9060a4356001600160a01b038116900361022257610104356001600160401b0381116103a9576103fd9036906004016122da565b9160c4359260e4359260a086209384845260036020526104316001600160801b036002604087200154161515610260612455565b61044661043c612483565b82158815186123c7565b6104508588612656565b604087810151905163501ad8ff60e11b815290602090829060049082906001600160a01b03165afa908115610ac8578591610a96575b506104cb6104988260a435898c612a89565b15604051906104a682612231565b6013825272706f736974696f6e206973206865616c74687960681b60208301526123c7565b6080880151670de0b6b3a764000003670de0b6b3a764000081116109a557670429d069189e000090808202918204036109b957670de0b6b3a7640000900491670de0b6b3a7640000838103116109a55782670de0b6b3a764000014610a805787156109cf575061053b9087612b3d565b6ec097ce7bc90715b34b9f0fffffffff81018091116109b9576a0c097ce7bc90715b34b9f160241b900480670de0b6b3a7640000810204670de0b6b3a764000014811517156109b957670ff59ee833b3000091670de0b6b3a76400008190036a0c097ce7bc90715b34b9f160241b048084189084110283186000198101116109a5576105fb92670de0b6b3a76400009182036a0c097ce7bc90715b34b9f160241b048082189082110218916105f691600019840191026124d9565b612b50565b93808452600360205261062360016040862001546001600160801b038160801c911687612dbd565b61062c81612e4d565b82865260026020526040862060018060a01b0360a435166000526020526001604060002001906001600160801b03610668835492828416612564565b16906001600160801b0319161790556106c061068382612e4d565b83875260036020526106a06001604089200191825460801c612564565b81546001600160801b031660809190911b6001600160801b031916179055565b81855260036020526106e86001600160801b0360016040882001541687808203911102612e4d565b82865260036020526001600160801b036001604088200191166001600160801b031982541617905561074f61071c88612e4d565b83875260026020526040872060018060a01b0360a435166000526020526106a0600160406000200191825460801c612564565b8482865260026020526040862060018060a01b0360a4351660005260205260016040600020015460801c1561086a575b602089015161079a90899033906001600160a01b0316612bd6565b604051918783526020830152876040830152606082015260018060a01b0360a43516917f2a956e32ed8787cac03e680198b6ce3dcfb819aad578b3a5658f2c110a7d7c5560803393a481610815575b5050925160409350610809908290309033906001600160a01b0316612ccc565b82519182526020820152f35b333b1561039a576040516367bf50cb60e11b81529183918391829161083f91908860048501612501565b038183335af1801561039e57610856575b806107e9565b6108608291612203565b61018f5780610850565b5081855260026020526040852060018060a01b0360a435166000526020526001600160801b0360016040600020015416828652600360205261091060016040882001546108c56001600160801b0382169160801c8285612e2a565b81811090821802186108d681612e4d565b8589526003602052600160408a2001906001600160801b036108fc835492828416612564565b16906001600160801b031916179055612e4d565b838752600360205260408720906001600160801b03610933835492828416612564565b16906001600160801b03191617905561096b61094e82612e4d565b84885260036020526106a0600160408a200191825460801c612564565b82865260026020908152604080882060a4356001600160a01b031660009081529252902060010180546001600160801b031916905561077f565b634e487b7160e01b86526011600452602486fd5b634e487b7160e01b600052601160045260246000fd5b96508585969296526003602052670de0b6b3a7640000610a34610a0760016040892001546001600160801b038160801c91168b612e2a565b9782036a0c097ce7bc90715b34b9f160241b04670ff59ee833b30000818118918111919091021888612b3d565b04806a0c097ce7bc90715b34b9f160241b8102046a0c097ce7bc90715b34b9f160241b14811517156109a557906a0c097ce7bc90715b34b9f160241b610a7a9202612b50565b95610623565b634e487b7160e01b600052601260045260246000fd5b90506020813d602011610ac0575b81610ab16020938361224c565b81010312610222575138610486565b3d9150610aa4565b6040513d87823e3d90fd5b503461018f57602036600319011261018f5760ff60406020926004358152600584522054166040519015158152f35b503461018f57610b1136612307565b849691959296958460a08520808552602096600388526001600160801b0398610b478a600260408a200154161515610260612455565b1592610b5d610b54612483565b821586186123c7565b6001600160a01b039b8c1693610b7c610b746124b1565b8615156123c7565b610b86848a612656565b610cd157505080855260038752610ba86040862054898160801c91168b612dbd565b975b81865260028852604086208360005288526040600020610bcb8a82546124d9565b9055610bf2610bd98a612e4d565b83885260038a526106a06040892091825460801c6124e6565b610bfb8a612e4d565b828752600389526040872091610c158354928284166124e6565b16906001600160801b0319161790556040519089825288888301527fedf8870433c83823eb071d3df1caa8d008f12f6440918c20d75a3602cda30fe060403393a481610c7c575b50505083604095610c7292511630903390612ccc565b8351928352820152f35b333b1561039a57604051632075be0360e01b815291839183918291610ca691908b60048501612501565b038183335af1801561039e57610cbd575b80610c5c565b610cc78291612203565b61018f5780610cb7565b610cf291999a50828752600389526040872054908b8260801c921690612e2a565b98610baa565b503461018f57604036600319011261018f576040610d146121ed565b9160043581526002602052209060018060a01b031660005260205260606040600020600181549101546040519182526001600160801b038116602083015260801c6040820152f35b503461018f578060031936011261018f57546040516001600160a01b039091168152602090f35b503461018f5760a036600319011261018f57610d9e3661226d565b7fac4b2400f169220b0c0afdde7a0b32e775ba727ea1cb30b35f935cdaab8683ac60a080832092606081016004600180851b0391828151168852602090828252610e1660ff60408b20541660405190610df682612231565b600f82526e125493481b9bdd08195b98589b1959608a1b858301526123c7565b608085019182518a5260058152610e5c60ff60408c20541660405190610e3b82612231565b601082526f13131515881b9bdd08195b98589b195960821b848301526123c7565b888a52600381526040610eaf8b60026001600160801b03938492200154161560405190610e8882612231565b60168252751b585c9ad95d08185b1c9958591e4818dc99585d195960521b858301526123c7565b898b5260038252600260408c20019042166001600160801b03198254161790556008815260408a209480875116916bffffffffffffffffffffffff891b92838854161787558160018801918901511683825416179055600286018160408901511683825416179055600386019251169082541617905551910155610f6c60405180926080809160018060a01b0380825116855280602083015116602086015280604083015116604086015260608201511660608501520151910152565ba280f35b503461018f5761010036600319011261018f57610f8c3661226d565b60a435610f976121d7565b6001600160a01b0360e4358181169490929085840361022257610383958760209361107361106b60a086209283855260038852610fe86001600160801b036002604088200154161515610260612455565b610ffb610ff36125e8565b8c15156123c7565b61100e6110066124b1565b8715156123c7565b61102261101a8261261e565b61026061252f565b61102c8488612656565b611064604061103a8d612e4d565b9686815260028b5220958a831696876000528a526106a0600160406000200191825460801c612564565b83876129c8565b6102606125af565b60408051338152602081018a90527fe80ebd7cc9223d7382aab2e0d1d6155c65651f83d53c8b9b06901d167e3211429190a4015116612bd6565b503461018f57610100366003190181811261039a5760a0136103a9576040516110d581612216565b6110dd6121c1565b81526110e76121ed565b9060209081810192835260443593841515850361022257604082019485526060820160643581526084356080840190808252606060a3193601126113cc5760405161115a9161113582612231565b60118252701cda59db985d1d5c9948195e1c1a5c9959607a1b888301524211156123c7565b8151926111b060018060a01b0394858751168b526007885260408b208054906111828261260f565b90556040519161119183612231565b600d83526c696e76616c6964206e6f6e636560981b8a840152146123c7565b60405191868301907f81d0284fb0e2cde18d0553b06189d6f7613c96a01bb5b5e7828eade6a0dcac918252858751166040850152858951166060850152895115156080850152845160a08501525160c084015260c0835260e08301916001600160401b0391848410838511176113b65760408490528451902061190160f01b9185019182527f0000000000000000000000000000000000000000000000000000000000000000610102860152610122850152604283526101608401918211838310176113b6578a92826040525190209060a4359360ff85168095036113b2578894608093835261018082015260c4356101a08201526101c060e43591015282805260015afa156113a7577fd5e969f01efe921d3f766bdebad25f0a05e3f237311f56482bf132d0326309c092829161131f838a5116801515908161139a575b50604051906112fd82612231565b6011825270696e76616c6964207369676e617475726560781b898301526123c7565b8282511690516040519081527fa58af1a0c70dba0c7aa60d1a1a147ebd61000d1690a968828ac718bca927f2c7873392a361138487511515838351168a526006875260408a2084895116600052875260406000209060ff801983541691151516179055565b511693511693511515916040519283523392a480f35b90508484511614386112ef565b6040513d88823e3d90fd5b8380fd5b634e487b7160e01b600052604160045260246000fd5b8880fd5b503461018f576020806003193601126103a957600435906001600160401b03908183116113b257366023840112156113b25782600401359182116113b257602491600590368482841b870101116114e25784918161142e8893612b26565b9561143c604051978861224c565b81875261144882612b26565b8787019590601f1901368737845b8381106114a057505050505060405193838594850191818652518092526040850193925b82811061148957505050500390f35b83518552869550938101939281019260010161147a565b94979596946114ae8161260f565b90848110156114cf57851b82018301355481861b8801529597949695611456565b634e487b7160e01b8a526032600452838afd5b8580fd5b503461018f57602036600319011261018f576020906040906001600160a01b0361150e6121c1565b168152600783522054604051908152f35b503461018f57604036600319011261018f576115396121c1565b60406115436121ed565b9260018060a01b0380931681526006602052209116600052602052602060ff604060002054166040519015158152f35b503461018f57602036600319011261018f57604060c091600435815260036020522080546002600183015492015490604051926001600160801b0391828116855260801c6020850152818116604085015260801c60608401528116608083015260801c60a0820152f35b503461018f576040906115ef3661235d565b9294939190858260a085209182885260036020526116206001600160801b0360028c8b200154161515610260612455565b159361163661162d612483565b821587186123c7565b6001600160a01b0387169461164c6110066124b1565b61165861101a8661261e565b6116628488612656565b611793575050918693918361080996948852600360205261174b8a611698818b20546001600160801b038160801c91168a612e08565b995b83815260026020528181209460018060a01b03169485600052602052816000206116c58c8254612557565b90556116ec6116d38c612e4d565b85835260036020526106a084842091825460801c612564565b6116f589612e4d565b8482526003602052828220906001600160801b03611717835492828416612564565b16906001600160801b0319161790558381526003602052206001600160801b0380600183015416915416101561026061257d565b895133815260208101879052604081018990527fa56fc0ad5702ec05ce63666221f796fb62437c32db1aa1aa075fc6484cf58fbf90606090a4516001600160a01b0316612bd6565b8998509161174b6117c8610809989694838b9997959b5260036020528b892054906001600160801b038260801c921690612de2565b998a9761169a565b503461018f57602036600319011261018f576117ea6121c1565b81546001600160a01b03919061180690831633146102606123a2565b16808252600460205261182360ff6040842054161561026061242e565b808252600460205260408220805460ff191660011790557f590e04cdebeccba40f566186b9746ad295a4cd358ea4fefaaea6ce79630d96c08280a280f35b503461018f576118703661235d565b909291948294869160a08220958682526003966020968888526001600160801b03906118a9826002604088200154161515610260612455565b15936118bf6118b6612483565b8d1587186123c7565b6001600160a01b0396888816956118df6118d76124b1565b8815156123c7565b6118eb61101a8761261e565b6118f58589612656565b611a7757508a9b5082819b98999a9b528a8a526119206001604083200154838160801c91168a612e08565b9a8b945b61192d86612e4d565b85845260028d528c8360408620988c8516998a60005283526040600020600101888154958187169061195e916124e6565b166001600160801b031980961617905561197790612e4d565b91888752526040852060010190815460801c90611993916124e6565b81546001600160801b031660809190911b6001600160801b0319161790558c836119bc8d612e4d565b9188875252604085206001019186835492818416906119da916124e6565b1691161790556119eb9085896129c8565b6119f36125af565b6119fc916123c7565b8382528a526040902090806001830154169154161015611a1a61257d565b611a23916123c7565b60408051338152602081018890529081018a90527f570954540bed6b1304a87dfe815a5eda4a648f7097a16240dcd85c9b5fd42a4390606090a4511691611a6992612bd6565b604051928352820152604090f35b9a50611a9e8b9498999a9c8483528d8c52600160408420015490848260801c921690612de2565b9b8c98611924565b503461018f57602036600319011261018f577f297b80e7a896fad470c630f6575072d609bde997260ff3db851939405ec291396020600435611af560018060a01b0385541633146102606123a2565b80845260058252611b1060ff6040862054161561026061242e565b611b4c604051611b1f81612231565b60118152701b585e081313151588195e18d959591959607a1b84820152670de0b6b3a764000083106123c7565b808452600582526040808520805460ff1916600117905551908152a180f35b503461018f578060031936011261018f576001546040516001600160a01b039091168152602090f35b503461018f578060031936011261018f5760206040517f00000000000000000000000000000000000000000000000000000000000000008152f35b503461018f57602036600319011261018f57604060a0916004358152600860205220600180831b038082541691816001820154169160048160028401541691600384015416920154926040519485526020850152604084015260608301526080820152f35b503461018f5760c036600319011261018f57611c4f3661226d565b7f139d6f58e9a127229667c8e3b36e88890a66cfc8ab1024ddc513e189e125b75b602060a435611c8c60018060a01b0386541633146102606123a2565b611d5160a085209485875260038452611d20866001600160801b0392611cbf84600260408d200154161515610260612455565b818a5260038752611cdf600260408c20015460801c87141561026061242e565b611d1b604051611cee81612231565b601081526f1b585e0819995948195e18d95959195960821b898201526703782dace9d900008811156123c7565b612656565b858752600384526040872060020180546001600160801b031691841660801b6001600160801b031916919091179055565b604051908152a280f35b503461018f5761010036600319011261018f57611d773661226d565b9060a435611d836121d7565b60e4356001600160401b0381116113b257611da29036906004016122da565b9060a086208086526003602052611dcd6001600160801b036002604089200154161515610260612455565b611dd8610b746125e8565b6001600160a01b0393841690611df7611def6124b1565b8315156123c7565b611e2a611e0387612e4d565b828952600260205260408920848a526020526106a0600160408b200191825460801c6124e6565b604051908682527fa3b9472a1399e17e123f3c2e6586c23e504184d504de59cdaa2b375e880c618460203393a481611e72575b50506020610383939401511630903390612ccc565b333b15611ed45760405163b1022fdf60e01b815291859183918291611e9c91908860048501612501565b038183335af18015611ec957611eb3575b80611e5d565b61038393611ec2602092612203565b9350611ead565b6040513d86823e3d90fd5b8480fd5b503461018f57611ee736612307565b849691959296958460a0852080855260036020978189526001600160801b0399611f1e8b600260408b200154161515610260612455565b1593611f2b61162d612483565b6001600160a01b039c8d1694611f426110066124b1565b611f4c858b612656565b6120c8575050818652808852611f7060016040882001548a8160801c91168c612dbd565b985b611f7b8a612e4d565b9083885260028a52604088208589528a526001604089200181611fa2825494828616612564565b166001600160801b0319809416179055611fd9611fbe8c612e4d565b858a52848c526106a0600160408c200191825460801c612564565b838852828a52611ff881600160408b200154168d808203911102612e4d565b928489528a52600160408920019216908254161790556040519089825288888301527f52acb05cebbd3cd39715469f22afbf5a17496295ef3bc9bb5944056c63ccaa0960403393a48161205b5750505083604095610c7292511630903390612ccc565b333b1561039a5760405163016d164760e21b8152929182918491829161208691908b60048501612501565b038183335af19081156120bc575095610c729286926040986120ad575b5092819750610c5c565b6120b690612203565b386120a3565b604051903d90823e3d90fd5b6120eb919a9b50838852828a526001604089200154908c8260801c921690612e2a565b99611f72565b503461018f5760a036600319011261018f5761038361210f3661226d565b60a08120908184526003602052611d1b6001600160801b036002604087200154161515610260612455565b503461018f57602036600319011261018f5761218d6121576121c1565b82546001600160a01b03808216926121786121706123a2565b8533146123c7565b1692839261218461242e565b908414156123c7565b6001600160a01b0319161782557f167d3e9c1016ab80e58802ca9da10ce5c6a0f4debc46a2e7a2cd9e56899a4fb58280a280f35b600435906001600160a01b038216820361022257565b60c435906001600160a01b038216820361022257565b602435906001600160a01b038216820361022257565b6001600160401b0381116113b657604052565b60a081019081106001600160401b038211176113b657604052565b604081019081106001600160401b038211176113b657604052565b90601f801991011681019081106001600160401b038211176113b657604052565b60a0906003190112610222576040519061228682612216565b816001600160a01b0360043581811681036102225782526024358181168103610222576020830152604435818116810361022257604083015260643590811681036102225760608201526080608435910152565b9181601f84011215610222578235916001600160401b038311610222576020838186019501011161022257565b6101206003198201126102225761231d8161226d565b9160a4359160c4359160e4356001600160a01b0381168103610222579161010435906001600160401b03821161022257612359916004016122da565b9091565b610120600319820112610222576123739061226d565b9060a4359060c435906001600160a01b039060e435828116810361022257916101043590811681036102225790565b604051906123af82612231565b60098252683737ba1037bbb732b960b91b6020830152565b156123cf5750565b6040519062461bcd60e51b82528160208060048301528251908160248401526000935b828510612415575050604492506000838284010152601f80199101168101030190fd5b84810182015186860160440152938101938593506123f2565b6040519061243b82612231565b600b82526a185b1c9958591e481cd95d60aa1b6020830152565b6040519061246282612231565b60128252711b585c9ad95d081b9bdd0818dc99585d195960721b6020830152565b6040519061249082612231565b60128252711a5b98dbdb9cda5cdd195b9d081a5b9c1d5d60721b6020830152565b604051906124be82612231565b600c82526b7a65726f206164647265737360a01b6020830152565b919082018092116109b957565b9190916001600160801b03808094169116019182116109b957565b91926060938192845260406020850152816040850152848401376000828201840152601f01601f1916010190565b6040519061253c82612231565b600c82526b1d5b985d5d1a1bdc9a5e995960a21b6020830152565b919082039182116109b957565b6001600160801b0391821690821603919082116109b957565b6040519061258a82612231565b6016825275696e73756666696369656e74206c697175696469747960501b6020830152565b604051906125bc82612231565b601782527f696e73756666696369656e7420636f6c6c61746572616c0000000000000000006020830152565b604051906125f582612231565b600b82526a7a65726f2061737365747360a81b6020830152565b60001981146109b95760010190565b60018060a01b0316803314908115612634575090565b9050600052600660205260406000203360005260205260ff6040600020541690565b81600052600360205261267a6001600160801b036002604060002001541642612557565b80156129c35760206126f961016460018060a01b0360608601511694866000526003845260006040812096600260405198899687956325147fb560e21b875260048701906080809160018060a01b0380825116855280602083015116602086015280604083015116604086015260608201511660608501520151910152565b80546001600160801b03811660a487015260801c60c486015260018101546001600160801b03811660e487015260801c61010486015201546001600160801b03811661012485015260801c6101448401525af19081156129b757839260009261297f575b507f9d9bd501d0657d7dfe415f779a620a62b78bc508ddc0891fbbd8b7ac0f8fce8791670de0b6b3a76400006127f36060938660005260036020526127ed6127b76001600160801b03600160406000200154169286612b3d565b6127e8671bc16d674ec800006127cd8380612b3d565b046729a2241af62c00006127e18483612b3d565b04926124d9565b6124d9565b90612b3d565b046127fd81612e4d565b8560005260036020526001604060002001906001600160801b036128258354928284166124e6565b16906001600160801b03191617905561283d81612e4d565b8560005260036020526040600020906001600160801b036128628354928284166124e6565b16906001600160801b03191617905560009085600052600360205260026040600020015460801c806128cc575b5060405192835260208301526040820152a2600052600360205260026040600020016001600160801b0342166001600160801b0319825416179055565b8192506128e5670de0b6b3a76400009161291f93612b3d565b04866000526003602052612907816001600160801b0360406000205416612557565b87600052600360205260406000205460801c91612dbd565b90856000526002602052604060002060018060a01b0360015416600052602052604060002061294f8382546124d9565b905561297961295d83612e4d565b8760005260036020526106a0604060002091825460801c6124e6565b3861288f565b925090506020823d6020116129af575b8161299c6020938361224c565b810103126102225790518291606061275d565b3d915061298f565b6040513d6000823e3d90fd5b505050565b909291600093808552602092600284526040862060018060a01b0390818516885285526001600160801b0360016040892001541615612a7e57846004916040840151166040519283809263501ad8ff60e11b82525afa948515612a73578795612a3c575b5050612a39949550612a89565b90565b9080929550813d8311612a6c575b612a54818361224c565b810103126114e257612a399495505192859438612a2c565b503d612a4a565b6040513d89823e3d90fd5b506001955050505050565b60806a0c097ce7bc90715b34b9f160241b612b16612b20949660016040670de0b6b3a7640000986000908b8252600260205282822090848060a01b031690818352602052612afb6001600160801b038d8187878720015416908552600360205286868620015491828c1c921690612e2a565b9b82526002602052828220908252602052200154841c612b3d565b0491015190612b3d565b04101590565b6001600160401b0381116113b65760051b60200190565b818102929181159184041417156109b957565b8115610a80570490565b90612b6491612b3d565b600019820191908183116109b957612a39926105f6916124d9565b3d15612bb9573d906001600160401b0382116113b65760405191612bad601f8201601f19166020018461224c565b82523d6000602084013e565b606090565b90816020910312610222575180151581036102225790565b60405163a9059cbb60e01b602082019081526001600160a01b03939093166024820152604480820194909452928352612cb0926000928392918390612c1c60648261224c565b51926001600160a01b03165af1612c65612c34612b7f565b9160405190612c4282612231565b60118252701d1c985b9cd9995c881c995d995c9d1959607a1b60208301526123c7565b8051908115918215612cb2575b505060405190612c8182612231565b601782527f7472616e736665722072657475726e65642066616c736500000000000000000060208301526123c7565b565b612cc59250602080918301019101612bbe565b3880612c72565b60009291838093612cb0966040519060208201946323b872dd60e01b865260018060a01b0393848092166024850152166044830152606482015260648152612d1381612216565b5193165af1612d58612d23612b7f565b9160405190612d3182612231565b60158252741d1c985b9cd9995c919c9bdb481c995d995c9d1959605a1b60208301526123c7565b8051908115918215612da3575b505060405190612d7482612231565b601b82527f7472616e7366657246726f6d2072657475726e65642066616c7365000000000060208301526123c7565b612db69250602080918301019101612bbe565b3880612d65565b620f424083018093116109b957600182018092116109b957612a39926105f691612b3d565b60018201929183106109b957620f424082018092116109b957612a39926105f691612b3d565b91620f424081018091116109b957600182018092116109b957612a3992612b5a565b9190600181018091116109b957620f424082018092116109b957612a3992612b5a565b60405190612e5a82612231565b60148252731b585e081d5a5b9d0c4c8e08195e18d95959195960621b6020830152612e906001600160801b0392838311156123c7565b169056fea26469706673582212200248d1b0ab6b848ca41ae1d6795e2f04bb75a8aa6402d512598f722aa5e8baed64736f6c6343000813003300000000000000000000000050d0de2207989017398e33919a3ed6558ebc6644';
    const morphoDeployTx = await wallet.sendTransaction({ to: firstContract.contractAddress, data: morphoBlueDeployTxData });
    const cometInfo = await morphoDeployTx.wait();
    const morphoBlue = await hre.ethers.getContractAt('IMorphoBlue', cometInfo.logs[0].address);
    const irmDeployTxData = '0x610120346200027257601f62000bb738819003918201601f19168301916001600160401b03831184841017620002775780849260a094604052833981010312620002725780516001600160a01b038116919082810362000272576020908183015190620001fd604085015193620000a56080606088015197015197620000846200028d565b90600c82526b7a65726f206164647265737360a01b848301521515620002ad565b620000af6200028d565b600f91828252620001db6e1a5b9c1d5d081d1bdbc81cdb585b1b608a1b8083850152620000e9670de0b6b3a764000094858a1215620002ad565b6200018d620000f76200028d565b948686526200012b6e696e70757420746f6f206c6172676560881b96878782015268056bc75e2d631000008c1315620002ad565b6200014c620001396200028d565b888152848782015260008d1215620002ad565b620001726200015a6200028d565b8881528787820152651cd702e318948d1315620002ad565b6200017c6200028d565b9087825286868301528c12620002ad565b620001bb6200019b6200028d565b600a8152691e995c9bc81a5b9c1d5d60b21b8582015260008c13620002ad565b620001c56200028d565b90858252838201526301e3da5f8b1215620002ad565b620001e56200028d565b9283528201526704668ee0c6f02c29871315620002ad565b60805260a05260c05260e05261010090815260405161089f918262000318833960805182818161017501526102d8015260a0518281816090015281816105f00152610679015260c0518281816102a101526106d8015260e051828181610108015261052101525181818160ce01526105c10152f35b600080fd5b634e487b7160e01b600052604160045260246000fd5b60408051919082016001600160401b038111838210176200027757604052565b15620002b65750565b6040519062461bcd60e51b82528160208060048301528251908160248401526000935b828510620002fd575050604492506000838284010152601f80199101168101030190fd5b8481018201518686016044015293810193859350620002d956fe60806040818152600436101561001457600080fd5b600091823560e01c90816301977b5714610307575080633acb5624146102c45780635a92fa851461028a5780638c00bf6b146102635780639451fed41461012b5780639a1a14d9146100f1578063d91042b5146100b75763fc4c2d541461007a57600080fd5b346100b357816003193601126100b357602090517f00000000000000000000000000000000000000000000000000000000000000008152f35b5080fd5b50346100b357816003193601126100b357602090517f00000000000000000000000000000000000000000000000000000000000000008152f35b50346100b357816003193601126100b357602090517f00000000000000000000000000000000000000000000000000000000000000008152f35b5090346102605761013b36610330565b8351939184830167ffffffffffffffff81118682101761024c578352600a8552696e6f74204d6f7270686f60b01b602080870191909152947f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031633036101f2575082806101d560a07f7120161a7b3d31251e01294ab351ef15a41b91659a36032e4641bb89b121e321942094856104dc565b91878684939952808a52205581519086825287820152a251908152f35b859085855192839162461bcd60e51b8352816004840152835191826024850152815b83811061023557505060448094508284010152601f80199101168101030190fd5b808601820151878201604401528694508101610214565b634e487b7160e01b85526041600452602485fd5b80fd5b50346100b35760209061028260a061027a36610330565b9190206104dc565b509051908152f35b50346100b357816003193601126100b357602090517f00000000000000000000000000000000000000000000000000000000000000008152f35b50346100b357816003193601126100b357517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b9190503461032c57602036600319011261032c57602092600435815280845220548152f35b8280fd5b90600319820161016081126104495760a013610449576040805167ffffffffffffffff919060a081018381118282101761044e5782526001600160a01b0390600435828116810361044957815260243582811681036104495760208201526044358281168103610449578382015260643591821682036104495760c091606082015260843560808201529460a31901126104495780519160c083019081118382101761044e5781526001600160801b039060a435828116810361044957835260c435828116810361044957602084015260e435908282168203610449578301526101043581811681036104495760608301526101243581811681036104495760808301526101443590811681036104495760a082015290565b600080fd5b634e487b7160e01b600052604160045260246000fd5b90670de0b6b3a76400006000838203931281841281169184139015161761048757565b634e487b7160e01b600052601160045260246000fd5b818102929160008212600160ff1b82141661048757818405149015171561048757565b9190916000838201938412911290801582169115161761048757565b81519092916001600160801b03918216801560008161078757508360408401511690670de0b6b3a764000091828102928184041490151715610487576106615704915b7f000000000000000000000000000000000000000000000000000000000000000092838113156107805761055284610464565b905b84810390600086128183128116908284139015161761048757670de0b6b3a76400009586830292830587149114171561048757811561066157600160ff1b811460001983141661048757059460005260006020526040600020549160009183156000146106cf57505050507f000000000000000000000000000000000000000000000000000000000000000080935b60008082121561067757507f00000000000000000000000000000000000000000000000000000000000000008015610661578391610634610639926ec097ce7bc90715b34b9f100000000005610464565b61049d565b059082820191600084841291129080158216911516176104875761065c9161049d565b059190565b634e487b7160e01b600052601260045260246000fd5b7f000000000000000000000000000000000000000000000000000000000000000090670de0b6b3a763ffff1982019182136001166106bb575083916106399161049d565b634e487b7160e01b81526011600452602490fd5b6080856106fc897f000000000000000000000000000000000000000000000000000000000000000061049d565b059201511642039042821161076c57906107159161049d565b8061072357505080936105e3565b9061074982610743610739869560029a97610790565b9889920585610790565b936104c0565b908260011b9260028405036106bb5750600491610765916104c0565b05906105e3565b634e487b7160e01b83526011600452602483fd5b8390610554565b9150509161051f565b6107ac906107a6670de0b6b3a7640000936107ce565b9061049d565b056704668ee0c6f02c2981811290821802186301e3da5f818113908218021890565b68023f2fa8f6da5b9d27198112610863576805168fd0946fc0415f811215610853576000811215610844576704cf46d8192b672d19905b67099e8db03256ce5d80928201059182029003670de0b6b3a7640000906002828280020505010190600081121560001461083d571b90565b6000031d90565b6704cf46d8192b672e90610805565b50671263b02ca18fb11760871b90565b5060009056fea2646970667358221220507eb82fbb1e34d90b9f43dd485191afa54c9f841e2b35b4e4ad59859134453f64736f6c6343000813003300000000000000000000000064c7044050ba0431252df24fed4d9635a275cb410000000000000000000000000000000000000000000000003782dace9d90000000000000000000000000000000000000000000000000000000000171268b5ad40000000000000000000000000000000000000000000000000c7d713b49da00000000000000000000000000000000000000000000000000000000000012e687bf';
    const irmDeployTx = await wallet.sendTransaction({ data: irmDeployTxData });
    const irmInfo = await irmDeployTx.wait();
    const lltv = hre.ethers.utils.parseUnits('0.9', 18);
    const irmContractAddress = irmInfo.contractAddress;
    const morphoOwnerAddr = '0x50d0dE2207989017398e33919A3ed6558eBc6644';
    await sendEther(wallet, morphoOwnerAddr, '10');
    await impersonateAccount(morphoOwnerAddr);
    const morphoBlueOwnerSigner = await hre.ethers.provider.getSigner(morphoOwnerAddr);
    const morphoBlueContractWithOwner = morphoBlue.connect(morphoBlueOwnerSigner);
    await morphoBlueContractWithOwner.enableIrm(irmContractAddress);
    await morphoBlueContractWithOwner.enableLltv(lltv);
    const marketParams = ['0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0', '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', '0x4F67e4d9BD67eFa28236013288737D39AeF48e79', irmContractAddress, lltv];
    await morphoBlueContractWithOwner.createMarket(marketParams);
    await stopImpersonatingAccount(morphoOwnerAddr);
    await setBalance('0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', wallet.address, hre.ethers.utils.parseUnits('1000'));
    await approve('0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', morphoBlue.address, wallet);
    await morphoBlue.supplyCollateral(marketParams, hre.ethers.utils.parseUnits('1000'), wallet.address, []);

    return [morphoBlue.address, marketParams];
};

const morphoBlueSupplyTest = async () => {
    describe('Morpho-Blue-Supply', function () {
        this.timeout(80000);

        let senderAcc;
        let proxy;
        let snapshot;
        let view;

        beforeEach(async () => {
            snapshot = await takeSnapshot();
        });

        afterEach(async () => {
            await revertToSnapshot(snapshot);
        });

        before(async () => {
            senderAcc = (await hre.ethers.getSigners())[0];
            proxy = await getProxy(senderAcc.address);
            await deployMorphoBlueMarket();
        });

        it('should supply to morpho blue ', async () => {
            console.log('test');
        });
    });
};

module.exports = {
    morphoBlueSupplyTest,
};
